import{gsap as t,Draggable as e,Flip as i,InertiaPlugin as r,SlowMo as o,RoughEase as s}from"./external/greensock/all.js";import a from"./utilities.js";import n from"./constants.js";import{SessionData as h,SetPhase as c,Update as l}from"./kult-tarot.js";import d from"./table.js";import u from"./tarot-card.js";export default class p{static t(t){return h.o?.i.find((e=>e.h===parseInt(t.dataset.h)))}static l(){}constructor(e,i){this.u=i,this.p=[...n.g["m"],...["crescents","eyes","hourglasses","roses","skulls"].map((t=>n.g["$"][t].slice(1))).flat()],t.v.k(this.p),this.C=e}get x(){return this.j}set x(t){this.j=t}get y(){return this.S}set y(t){this.S=t}get z(){return this.O}set z(t){this.O=t}get session(){return this.u}get H(){return this.session.H}get o(){return this.p}get I(){return this.M}get i(){return this.P}get X(){return this.i.map((t=>t.Z))}get type(){return this.C}get id(){return`deck-box-${this.type}`}get B(){return this.session.o&&this.session.o.type===this.type}get D(){return this.F=this.F??a.G(`${this.type}/card-back-${t.v.random(1,n.W[this.type],1)}.webp`)}q(e){const i=a.A({id:this.id,J:"deck-box",dimensions:{x:n.K.width,y:n.K.height,z:n.L},N:{bottom:"linear-gradient(#222, #000)",right:"linear-gradient(#222, #000)",left:"linear-gradient(#222, #000)",R:this.D,back:"black",top:"black"},T:$("#card-layer")[0]});t.set(i,{x:this.x,y:this.y,pointerEvents:"all"}),$(i).hover(this.U.bind(this),this.V.bind(this)),$(i).click(this.Y.bind(this)),[this.M]=i,this._=t.timeline({paused:!0}),this._.to(this.I,{y:"+="+(1===e?1.5:.5)*a.tt(n.K.height),z:350,scale:2,et:-45,boxShadow:"0 0 60px red",duration:.5,it:"power.inOut"}),this._.to(`#${this.id} > .face-bottom`,{boxShadow:"none",duration:.25,it:"none"},0)}U(t){console.log("Hover On"),this.session.rt||(t.preventDefault(),this._.play())}V(t){t.preventDefault(),this._.reverse()}Y(t){this.session.rt||(t.preventDefault(),c(n.st.ot,{o:this}))}async nt(){const e=t.timeline();return this.x=n.ht[1].x,this.y=n.ht[1].y,this.z=-.4*n.L,e.to(`.deck-box:not(#${this.id})`,{opacity:0,it:"sine.inOut",duration:1,ct:{lt:.5,from:"random",dt(){$(this.ut()[0]).remove()}}}),e.to(this.I,{x:this.x,y:this.y,z:this.z,it:"sine.inOut",duration:2},1.5),e.to(".canvas-layer",{scale:.65,it:"power",duration:5,gt:this,dt(){return this.yt().then(this.xt.bind(this))}},0),e.to(".canvas-layer:not(#control-layer)",{et:25,duration:5,it:"power"},0),e}async yt(){return this.P=this.o.map(((t,e,i)=>new u(t,e,this))),this.i.forEach((t=>t.q())),t.to(".tarot-card-main",{opacity:1,duration:.5,ct:{$t:.05,from:"end"}})}xt(){$('<div id="rotation-container-0" class="rotation-container"></div>').appendTo($("#over-layer")),$('<div id="rotation-container-1" class="rotation-container"></div>').appendTo($("#over-layer")),t.set(".rotation-container",{bt:-50,kt:-50,x:"50%",y:"50%",height:"100%",width:"100%"}),$(".tarot-card-main").lt(((t,e)=>$(e).appendTo($(`#rotation-container-${a.ft(0,1)}`))));const[e,i]=[this.x,this.y],r=n.vt*(i-n.padding.y),o=360/(this.i.length/2),s=(n.wt,this.i.length,t.timeline());return s.to(".tarot-card-main",{x:(i,s)=>e+r*a.Ct(o*i)+t.v.random(-150,150),y:(e,s)=>i+r*a.zt(o*e)+t.v.random(-150,150),z:()=>200+t.v.random(0,100),duration:1,ct:{lt:-.05,dt(){t.Et.jt(this.ut()[0])}},it:"power2.out",St(){$(h.o.I).remove()},dt(){t.set(".tarot-card-main",{pointerEvents:"all"}),h.rt=!1}}),s.to("#rotation-container-0, #rotation-container-1 > .tarot-card-main",{Ot:"+=360",duration:150,repeat:-1,it:"none"},1),s.to("#rotation-container-1, #rotation-container-0 > .tarot-card-main",{Ot:"-=360",duration:150,repeat:-1,it:"none"},1),s}Ht(e){const r=this.constructor.t(e),o=this.table.It;if(o){this.H[o].K=r,r.slot=o;const s=i.getState(e,"outlineColor,outlineWidth");$(e).appendTo("#control-layer"),t.set(e,{rotation:0,scale:1,boxShadow:"rgb(255 166 33) 0px 0px 0px",...this.table.H[o].Mt}),i.from(s,{duration:2,it:"expo.out",absolute:!0,Pt:!0,Xt:!0,scale:!0,dt(){$(e).appendTo("#card-layer"),5===o&&(t.Zt(".canvas-layer"),t.Et.Bt())}})}}}