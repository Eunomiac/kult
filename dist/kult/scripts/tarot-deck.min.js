import{gsap as t,Flip as e,SlowMo as i,RoughEase as s}from"./external/greensock/all.js";import r from"./utilities.js";import a from"./constants.js";import{SessionData as n,SetPhase as o,Update as h}from"../kult.js";import c from"./tarot-card.js";export default class d{static t(t){return n.o?.i.find((e=>e.h===parseInt(t.dataset.h)))}static l(){}constructor(e,i){this.u=i,this.p=[...a.m["g"],...["crescents","eyes","hourglasses","roses","skulls"].map((t=>a.m["$"][t].slice(1))).flat()],t.v.k(this.p),this.C=e}get x(){return this.j}set x(t){this.j=t}get y(){return this.S}set y(t){this.S=t}get z(){return this.I}set z(t){this.I=t}get session(){return this.u}get O(){return this.session.O}get o(){return this.p}get H(){return this.M}get i(){return this.P}get Z(){return this.i.map((t=>t.B))}get type(){return this.C}get id(){return`deck-box-${this.type}`}get D(){return this.session.o&&this.session.o.type===this.type}get F(){return this.G=this.G??r.X(`${this.type}/card-back-${t.v.random(1,a.q[this.type],1)}.webp`)}A(e){const i=r.J({id:this.id,K:"deck-box",dimensions:{x:a.L.width,y:a.L.height,z:a.N},R:{bottom:"linear-gradient(#222, #000)",right:"linear-gradient(#222, #000)",left:"linear-gradient(#222, #000)",T:this.F,back:"black",top:"black"},U:$("#card-layer")[0]});t.set(i,{x:this.x,y:this.y,pointerEvents:"all"}),$(i).hover(this.V.bind(this),this.W.bind(this)),$(i).click(this.Y.bind(this)),[this.M]=i,this._=t.timeline({paused:!0}).to(this.H,{z:t.tt(this.H,"z")+100,scale:1.5,duration:.5,et:"power.inOut"},0).to(`#${this.id} > .face-back`,{boxShadow:"none",duration:.25,et:"none"},0).to(`#${this.id} > .face-front`,{boxShadow:"0 0 150px lime",duration:.5,et:"power.inOut"},0),this.it=t.timeline({repeat:-1,st:!0,paused:!0})}V(t){this.session.rt||(t.preventDefault(),this._.play(),this.it.play())}W(t){t.preventDefault(),this.it.nt().pause(),this._.reverse()}Y(t){console.log(n),n.rt||n.ot!==a.ct.ht||(t.preventDefault(),o(a.ct.dt,{o:this}))}async lt(){const e=t.timeline();return this.x=a.ut[1].x,this.y=a.ut[1].y,this.z=-.4*a.N,e.to(`.deck-box:not(#${this.id})`,{opacity:0,et:"sine.inOut",duration:1,gt:{yt:.5,from:"random",xt(){$(this.ft()[0]).remove()}}}),e.to(this.H,{x:this.x,y:this.y,z:this.z,et:"sine.inOut",duration:2},1.5),e.to(".canvas-layer:not(#control-layer)",{scale:.65,$t:25,y:"-=9vh",et:"power",duration:5,bt:this,xt(){return this.kt().then(this.vt.bind(this))}},0),e}async kt(){return this.P=this.o.map(((t,e,i)=>new c(t,e,this))),this.i.forEach((t=>t.A())),t.set(this.Z,{filter:"brightness(1.5)"}),t.set(this.Z[0],{filter:"brightness(1.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))"}),t.to(this.Z,{opacity:1,duration:0,gt:{yt:.05,from:"start"}})}vt(){$('<div id="rotation-container-0" class="rotation-container"></div>').appendTo($("#over-layer")),$('<div id="rotation-container-1" class="rotation-container"></div>').appendTo($("#over-layer")),t.set(".rotation-container",{wt:-50,zt:-50,x:"50%",y:"50%",height:"100%",width:"100%"}),$(".tarot-card-main").yt(((t,e)=>$(e).appendTo($(`#rotation-container-${r.Ct(0,1)}`))));const[e,i]=[this.x,this.y],s=a.jt*(i-a.padding.y),o=360/(this.i.length/2);a.St,this.i.length;t.to(this.Z,{x:(i,a)=>e+s*r.Et(o*i)+t.v.random(-150,150),y:(e,a)=>i+s*r.It(o*e)+t.v.random(-150,150),z:()=>100+t.v.random(0,50),filter:"brightness(0.4) saturate(0.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",duration:1,gt:{yt:.05,from:"end",Ot(){d.t(this.ft()[0]).Ht=parseInt(o*parseInt(this.ft()[0].dataset.h))},xt(){t.Pt.Mt(this.ft()[0])}},et:"power2.out",Ot(){$(n.o.H).remove()},xt(){n.rt=!1}}),t.Pt.Zt("#rotation-container-0",{Bt:"+=360",delay:1}),t.Pt.Zt("#rotation-container-1",{Bt:"-=360",delay:1})}}