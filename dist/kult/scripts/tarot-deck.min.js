import{gsap as t,Flip as e,SlowMo as i,RoughEase as s}from"./external/greensock/all.js";import r from"./utilities.js";import n from"./constants.js";import{SessionData as a,SetPhase as o,Update as h}from"../kult.js";import c from"./tarot-card.js";export default class d{static t(t){return a.o?.i.find((e=>e.h===parseInt(t.dataset.h)))}static l(){}constructor(e,i){this.u=i,this.p=[...n.m["g"],...["crescents","eyes","hourglasses","roses","skulls"].map((t=>n.m["k"][t].slice(1))).flat()],t.v.$(this.p),this.C=e}get x(){return this.j}set x(t){this.j=t}get y(){return this.I}set y(t){this.I=t}get z(){return this.S}set z(t){this.S=t}get session(){return this.u}get O(){return this.session.O}get o(){return this.p}get H(){return this.M}get i(){return this.P}get X(){return this.i.map((t=>t.Z))}get type(){return this.C}get id(){return`deck-box-${this.type}`}get B(){return this.session.o&&this.session.o.type===this.type}get D(){return this.F=this.F??r.G(`${this.type}/card-back-${t.v.random(1,n.q[this.type],1)}.webp`)}A(e){const i=r.J({id:this.id,K:"deck-box",dimensions:{x:n.L.width,y:n.L.height,z:n.N},R:{bottom:"linear-gradient(#222, #000)",right:"linear-gradient(#222, #000)",left:"linear-gradient(#222, #000)",T:this.D,back:"black",top:"black"},U:$("#card-layer")[0]});t.set(i,{x:this.x,y:this.y,pointerEvents:"all"}),$(i).hover(this.V.bind(this),this.W.bind(this)),$(i).click(this.Y.bind(this)),[this.M]=i,this._=t.timeline({paused:!0}).to(this.H,{z:t.tt(this.H,"z")+100,et:"-=25",scale:1.5,duration:.5,it:"power.inOut"},0).to(`#${this.id} > .face-back`,{boxShadow:"none",duration:.25,it:"none"},0),this.st=t.timeline({repeat:-1,rt:!0,paused:!0})}V(t){this.session.nt||(t.preventDefault(),this._.play(),this.st.play())}W(t){t.preventDefault(),this.st.ot().pause(),this._.reverse()}Y(t){console.log(a),a.nt||a.ht!==n.dt.ct||(t.preventDefault(),o(n.dt.lt,{o:this}))}async ut(){const e=t.timeline();return this.x=n.gt[1].x,this.y=n.gt[1].y,this.z=-.4*n.N,e.to(`.deck-box:not(#${this.id})`,{opacity:0,it:"sine.inOut",duration:1,yt:{xt:.5,from:"random",ft(){$(this.kt()[0]).remove()}}}),e.to(this.H,{x:this.x,y:this.y,z:this.z,it:"sine.inOut",duration:2},1.5),e.to(".canvas-layer:not(#control-layer)",{scale:.65,et:25,y:"-=9vh",it:"power",duration:5,$t:this,ft(){return this.bt().then(this.vt.bind(this))}},0),e}async bt(){return this.P=this.o.map(((t,e,i)=>new c(t,e,this))),this.i.forEach((t=>t.A())),t.set(this.X,{filter:"brightness(1.5)"}),t.set(this.X[0],{filter:"brightness(1.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))"}),t.to(this.X,{opacity:1,duration:0,yt:{xt:.05,from:"start"}})}vt(){$('<div id="rotation-container-0" class="rotation-container"></div>').appendTo($("#over-layer")),$('<div id="rotation-container-1" class="rotation-container"></div>').appendTo($("#over-layer")),t.set(".rotation-container",{wt:-50,zt:-50,x:"50%",y:"50%",height:"100%",width:"100%"}),$(".tarot-card-main").xt(((t,e)=>$(e).appendTo($(`#rotation-container-${r.Ct(0,1)}`))));const[e,i]=[this.x,this.y],s=n.jt*(i-n.padding.y),o=360/(this.i.length/2);n.Et,this.i.length;t.It(this.X,{filter:"none"},{x:(i,n)=>e+s*r.St(o*i)+t.v.random(-150,150),y:(e,n)=>i+s*r.Ot(o*e)+t.v.random(-150,150),z:()=>100+t.v.random(0,50),filter:"brightness(0.4) saturate(0.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",duration:1,yt:{xt:.05,from:"end",Ht(){d.t(this.kt()[0]).Mt=parseInt(o*parseInt(this.kt()[0].dataset.h))},ft(){t.Xt.Pt(this.kt()[0])}},it:"power2.out",Ht(){$(a.o.H).remove()},ft(){a.nt=!1}}),t.Xt.Zt("#rotation-container-0",{Bt:"+=360",delay:1}),t.Xt.Zt("#rotation-container-1",{Bt:"-=360",delay:1})}}