import{gsap as t,Draggable as e,Flip as i,InertiaPlugin as r,SlowMo as o,RoughEase as a}from"./external/greensock/all.js";import s from"./utilities.js";import n from"./constants.js";import{SessionData as h,SetPhase as c,Update as d}from"./kult-tarot.js";import l from"./tarot-card.js";export default class u{static t(t){return h.o?.i.find((e=>e.h===parseInt(t.dataset.h)))}static l(){}constructor(e,i){this.u=i,this.p=[...n.g["m"],...["crescents","eyes","hourglasses","roses","skulls"].map((t=>n.g["$"][t].slice(1))).flat()],t.v.k(this.p),this.C=e}get x(){return this.j}set x(t){this.j=t}get y(){return this.O}set y(t){this.O=t}get z(){return this.S}set z(t){this.S=t}get session(){return this.u}get Z(){return this.session.Z}get o(){return this.p}get H(){return this.I}get i(){return this.M}get P(){return this.i.map((t=>t.U))}get type(){return this.C}get id(){return`deck-box-${this.type}`}get B(){return this.session.o&&this.session.o.type===this.type}get D(){return this.F=this.F??s.G(`${this.type}/card-back-${t.v.random(1,n.W[this.type],1)}.webp`)}X(e){const i=s.q({id:this.id,A:"deck-box",dimensions:{x:n.J.width,y:n.J.height,z:n.K},L:{bottom:"linear-gradient(#222, #000)",right:"linear-gradient(#222, #000)",left:"linear-gradient(#222, #000)",N:this.D,back:"black",top:"black"},R:$("#card-layer")[0]});t.set(i,{x:this.x,y:this.y,pointerEvents:"all"}),$(i).hover(this.T.bind(this),this.V.bind(this)),$(i).click(this.Y.bind(this)),[this.I]=i,this._=t.timeline({paused:!0}),this._.to(this.H,{z:"+=100",scale:1.5,duration:.5,tt:"power.inOut"}),this._.to(`#${this.id} > .face-back`,{boxShadow:"none",duration:.25,tt:"none"},0),this._.to(`#${this.id} > .face-front`,{boxShadow:"0 0 150px lime",duration:.5,tt:"power.inOut"},0),this.et=t.timeline({repeat:-1,it:!0,paused:!0})}T(t){console.log("Hover On"),this.session.rt||(t.preventDefault(),this._.play(),this.et.play())}V(t){t.preventDefault(),this.et.ot().pause(),this._.reverse()}Y(t){this.session.rt||(t.preventDefault(),c(n.nt.st,{o:this}))}async ht(){const e=t.timeline();return this.x=n.ct[1].x,this.y=n.ct[1].y,this.z=-.4*n.K,e.to(`.deck-box:not(#${this.id})`,{opacity:0,tt:"sine.inOut",duration:1,dt:{lt:.5,from:"random",ut(){$(this.gt()[0]).remove()}}}),e.to(this.H,{x:this.x,y:this.y,z:this.z,tt:"sine.inOut",duration:2},1.5),e.to(".canvas-layer",{scale:.65,yt:25,tt:"power",duration:5,xt:this,ut(){return this.$t().then(this.kt.bind(this))}},0),e}async $t(){return this.M=this.o.map(((t,e,i)=>new l(t,e,this))),this.i.forEach((t=>t.X())),t.to(".tarot-card-main",{opacity:1,duration:0,dt:{lt:.05,from:"start"}})}kt(){$('<div id="rotation-container-0" class="rotation-container"></div>').appendTo($("#over-layer")),$('<div id="rotation-container-1" class="rotation-container"></div>').appendTo($("#over-layer")),t.set(".rotation-container",{ft:-50,bt:-50,x:"50%",y:"50%",height:"100%",width:"100%"}),$(".tarot-card-main").lt(((t,e)=>$(e).appendTo($(`#rotation-container-${s.vt(0,1)}`))));const[e,i]=[this.x,this.y],r=n.wt*(i-n.padding.y),o=360/(this.i.length/2),a=(n.Ct,this.i.length,t.timeline());return a.to(".tarot-card-main",{x:(i,a)=>e+r*s.zt(o*i)+t.v.random(-150,150),y:(e,a)=>i+r*s.jt(o*e)+t.v.random(-150,150),z:()=>200+t.v.random(0,100),duration:1,dt:{lt:-.05,ut(){t.Ot.Et(this.gt()[0])}},tt:"power2.out",St(){$(h.o.H).remove()},ut(){t.set(".tarot-card-main",{pointerEvents:"all"}),h.rt=!1}}),a.to("#rotation-container-0",{rotation:"+=360",duration:150,repeat:-1,tt:"none",Zt:()=>t.set("#rotation-container-0 > .tarot-card-main",{Ht:-1*t.It("#rotation-container-0","rotationZ")})},1),a.to("#rotation-container-1",{Ht:"-=360",duration:150,repeat:-1,tt:"none",Zt:()=>t.set("#rotation-container-1 > .tarot-card-main",{Ht:-1*t.It("#rotation-container-1","rotationZ")})},1),a}Mt(e){const r=this.constructor.t(e),o=this.table.Pt;if(o){this.Z[o].J=r,r.slot=o;const a=i.getState(e,"outlineColor,outlineWidth");$(e).appendTo("#control-layer"),t.set(e,{rotation:0,scale:1,boxShadow:"rgb(255 166 33) 0px 0px 0px",...this.table.Z[o].Ut}),i.from(a,{duration:2,tt:"expo.out",absolute:!0,Bt:!0,Dt:!0,scale:!0,ut(){$(e).appendTo("#card-layer"),5===o&&(t.Ft(".canvas-layer"),t.Ot.Gt())}})}}}