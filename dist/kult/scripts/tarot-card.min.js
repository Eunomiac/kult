import{gsap as t,Flip as e,MotionPathPlugin as i,RoughEase as s}from"./external/greensock/all.js";import r from"./utilities.js";import a from"./constants.js";import{SessionData as o,SetPhase as n,Update as h}from"../kult.js";import c from"./tarot-deck.js";export default class d{static t(){t.i({name:"cardWander",effect:e=>{const i=t.timeline();return i.to(e,{x:(e,i)=>t.o(i,"x")+t.h.random(-150,150),l:"sine.inOut",duration:3,u:{repeat:-1,p:!0,g:3,l:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}}),i.to(e,{y:(e,i)=>t.o(i,"y")+t.h.random(-50,50),l:"sine.inOut",duration:3,u:{repeat:-1,p:!0,g:3,l:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}},0),i}})}constructor(t,e,i){this.m=t,this.k=e,this.$=a.S.height,this.v=a.S.width,this.O=i,this.C=this.j.x,this.I=this.j.y,this.P=e*(a.Z/67),[this.M]=$(`<div id="${this.id}" class="tarot-card tarot-card-main tarot-card-${this.j.type}" data-card-num="${this.B}"></div>`).appendTo("#card-layer")}get j(){return this.O}get x(){return this.C=this.C??this.j.x}get y(){return this.I=this.I??this.j.y}get z(){return this.P=this.P??this.j.z}get height(){return this.$}get width(){return this.v}get id(){return`card-main-${this.j.type}-${this.B}`}get selector(){return`#${this.id}`}get B(){return this.k}get D(){return this.M??!1}get F(){return this.U=this.U??r.X(`${this.j.type}/card-back-${t.h.random(1,a._[this.j.type],1)}.webp`)}get slot(){return this.H}set slot(t){this.H=t,this.C=a.R[t].x,this.I=a.R[t].y,this.P=0}get angle(){return!!this.G&&r.N(this.G,t.o($(this.D).parent()[0],"rotationZ"))}get T(){return this.W?r.X(this.m.q):this.F}get W(){return o.A[this.slot]?.W}set W(t){o.A[this.slot].W=Boolean(t)}get J(){return this.W||!o.K?0:Math.max(0,this.slot-o.K)}get L(){return this.W?Object.entries(this.m.V).filter((([t,e])=>o.V.Y[t])).map((([t,e])=>e)).flat():[]}tt(){this.C=t.o(this.D,"x"),this.I=t.o(this.D,"y"),this.P=t.o(this.D,"z"),[this.et]=$(this.D).parent()}it(e){if(o.st)return!1;switch(o.rt){case"cardsInOrbit":return e.preventDefault(),this.ot(),!0;case"cardsDealt":if(e.preventDefault(),this.slot===o.K)this.nt();else{const e=o.A[o.K].S.selector,i=Object.values(o.A).filter((({W:t})=>!t)).map((({S:t})=>t.selector)).join(", ");t.ct.ht(i),t.ct.dt(e)}}return!0}lt(e){if(o.st)return!1;switch(e.preventDefault(),o.rt){case"cardsInOrbit":/rotation-container/.test($(this.D).parent()[0].id)&&(t.ut([this.D,$(this.D).parent()]),this.tt(),this.gt=parseInt(this.angle),this.bt=t.to(this.D,{z:Math.abs(this.gt)>115?400:250,width:1.5*a.S.width,height:Math.abs(this.gt)>115?a.S.height+r.xt(50,"vh"):1.25*a.S.height,backgroundColor:"transparent",kt:-15,filter:"brightness(1.5) saturate(1.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",l:"power2.out",duration:.5,ft:this,wt(){Math.abs(this.gt)>115?t.set(this.D,{backgroundPosition:"center bottom"}):t.set(this.D,{backgroundPosition:"center center"})}}));break;case"cardsDealt":{const e={};if(this.W){switch(this.slot){case 2:e.x="+="+a.S.width/3;break;case 3:e.y="+="+a.S.height/3;break;case 4:e.x="-="+a.S.width/3;break;case 5:e.y="-="+a.S.height/3}this.$t=t.to(this.D,{...e,scale:3,duration:.5,l:"power4.inOut",ft:this,yt(e,i){t.ct.St(this.D)}})}else this.slot===o.K&&(this.$t=t.to(this.D,{z:"+=50",duration:.5,l:"power4.inOut",boxShadow:"rgb(0 255 0) 0px 0px 50px",scale:1.2}))}}return!0}vt(e){switch(e.preventDefault(),o.rt){case"cardsInOrbit":return!!/rotation-container/.test($(this.D).parent()[0].id)&&t.to(this.D,{z:()=>150+t.h.random(0,50),width:a.S.width,height:a.S.height,backgroundColor:"transparent",kt:0,filter:"brightness(0.4) saturate(0.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",outline:"none",boxShadow:"none",l:"power2.out",duration:.5,delay:.25,ft:this,yt(){t.set(this.D,{backgroundPosition:"center center"}),/rotation-container/.test($(this.D).parent()[0].id)&&t.ct.St(this.D),t.ut(".rotation-container"),t.ct.zt("#rotation-container-0",{Ot:"+=360",delay:0}),t.ct.zt("#rotation-container-1",{Ot:"-=360",delay:0})}});case"cardsDealt":case"cardsRevealed":return this.$t?.reverse();default:return!1}}Ct(){t.set(this.D,{jt:-50,It:-50,x:this.x,y:this.y,z:this.z,height:this.height,width:this.width,backgroundImage:this.T,backgroundSize:`${this.width}px ${this.height}px`,pointerEvents:"all",opacity:0,Pt:!0}),$(this.D).click(this.it.bind(this)),$(this.D).hover(this.lt.bind(this),this.vt.bind(this))}ot(){const i=o.Zt;i&&(o.A[i].S=this,this.slot=i,t.to(this.D,{kt:0,z:400,duration:.25,l:"expo.in",ft:this,wt(){t.set(".tarot-card-main",{pointerEvents:5===i?"none":"all"})},yt(){t.ut(this.D);const s=e.getState(this.D,"boxShadow, filter, rotationZ");$(this.D).appendTo("#card-layer"),t.set(this.D,{Ot:0,z:0,height:a.S.height,width:a.S.width,scale:1,boxShadow:"none",filter:"brightness(1) saturate(1) drop-shadow(5px 5px 5px rgba(0,0,0,0.4))",...o.A[i].Et}),e.from(s,{duration:2,l:"expo.out",absolute:!0,Mt:!0,Bt:!0,scale:!0,ft:this,yt(){t.set(this.D,{backgroundPosition:"center center"}),5===i&&(t.ut(".canvas-layer, .canvas-layer *"),t.set(".tarot-card-main",{pointerEvents:"all"}),n(a.Ft.Dt))}})}}))}nt(e){$(this.D).off("click mouseenter"),this.W=!0,o.V.Ut[this.slot]=this.L,t.to(this.D,{duration:0,l:"circ",backgroundImage:this.T,ft:this,yt(){5===this.slot&&(this.$t?.reverse(),n(a.Ft.Xt))}})}}