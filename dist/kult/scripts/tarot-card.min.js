import{gsap as t,Flip as e,MotionPathPlugin as r,RoughEase as s}from"./external/greensock/all.js";import i from"./utilities.js";import a from"./constants.js";import{SessionData as o,SetPhase as n,Update as h}from"./kult-tarot.js";import c from"./table.js";import d from"./tarot-deck.js";export default class u{static t(){t.i({name:"cardWander",effect:e=>{const r=t.timeline();return r.to(e,{x:function(e,r){return t.o(r,"x")+t.h.random(-150,150)},u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}}),r.to(e,{y:function(e,r){return t.o(r,"y")+t.h.random(-50,50)},u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}},0),r}}),t.i({name:"cardWanderHoverOn",effect:s=>{[s]=[s].flat();const i=e.getState(s,"boxShadow"),{x:a,y:o}=r.g($(s).parent()[0],"#control-layer",{x:t.o(s,"x"),y:t.o(s,"y")});$(s).appendTo("#control-layer"),t.set(s,{$:0,scale:3,boxShadow:"rgb(255 166 33) 0px 0px 10px",x:a,y:o,z:500});const n=d.O(s);return n.v=e.from(i,{duration:.5,u:"power2.out",absolute:!0,k:!0,S:!0,scale:!0}),n.v}}),t.i({name:"cardWanderHoverOff",effect:t=>{[t]=[t].flat();return d.O(t).v.reverse()}})}constructor(t,e,r){this.j=t,this.C=e,this.D=a.H.height,this.I=a.H.width,this.Z=r,this.B=this.F.x,this.R=this.F.y,this.U=e*a.W/67,[this._]=$(`<div id="${this.id}" class="tarot-card tarot-card-main tarot-card-${this.F.type}" data-card-num="${this.P}"></div>`).appendTo("#card-layer")}get F(){return this.Z}get x(){return this.B=this.B??this.F.x}get y(){return this.R=this.R??this.F.y}get z(){return this.U=this.U??this.F.z}get height(){return this.D}get width(){return this.I}get id(){return`card-main-${this.F.type}-${this.P}`}get selector(){return`#${this.id}`}get P(){return this.C}get M(){return this._??!1}get N(){return this.T=this.T??i.q(`${this.F.type}/card-back-${t.h.random(1,a.A[this.F.type],1)}.webp`)}get slot(){return this.G}set slot(t){this.G=t,this.x=a.J[t].x,this.y=a.J[t].y}get K(){return this.L?i.q(this.j.V):this.N}get L(){return o.X[this.slot]?.L}set L(t){o.X[this.slot].L=Boolean(t)}get Y(){return this.L||!o.tt?0:Math.max(0,this.slot-o.tt)}et(e){if(o.rt)return!1;switch(o.st){case a.it:return void e.preventDefault();case a.ot:if(e.preventDefault(),this.slot===o.tt)this.nt();else{const e=o.X[o.tt].H.selector,r=Object.values(o.X).filter((({L:t})=>!t)).map((({H:t})=>t.selector)).join(", ");t.ct.ht(r),t.ct.dt(e)}break;default:return!1}}ut(s){if(console.log("On Hover",{event:s,lt:o,rt:o.rt,st:o.st}),o.rt)return!1;switch(o.st){case"cardsInOrbit":{this.xt={x:t.o(this.M,"x"),y:t.o(this.M,"y"),z:t.o(this.M,"z")},[this.gt]=$(this.M).parent();const[s]=$("#control-layer"),{x:i,y:a}=r.g(this.gt,s,{x:t.o(this.M,"x"),y:t.o(this.M,"y")});$(this.M).appendTo(s),t.set(this.M,{$:0,scale:3,boxShadow:"rgb(255 166 33) 0px 0px 10px",x:i,y:a,z:500}),e.from(cardState,{duration:.5,u:"power2.out",absolute:!0,k:!0,S:!0,scale:!0});break}case"cardsDealt":return this.ft(s);default:return!1}}yt(r){switch(o.st){case"cardsInOrbit":{const r=e.getState(this.M,"boxShadow");$(this.M).appendTo(this.gt),t.set(this.M,{...this.xt,$:-1*t.o(this.gt,"rotationZ"),scale:1,boxShadow:"none"}),e.from(r,{duration:.5,u:"power2.out",absolute:!0,k:!0,S:!0,scale:!0});break}case"cardsDealt":return this.bt(r);default:return!1}}wt(){t.set(this.M,{$t:-50,Ot:-50,x:this.x,y:this.y,z:this.z,height:this.height,width:this.width,background:this.K,pointerEvents:"all",opacity:0,vt:!0})}nt(e){$(this.M).off("click mouseenter"),this.L=!0,t.to(this.M,{duration:0,u:"circ",background:this.K}),5===this.slot&&t.to("#card-layer",{x:`-=${o.X[2].kt.x-.5*a.H.width-a.padding.x}px`,duration:2,u:"expo4"})}ft(e){["CardsDealt","CardsRevealed"].includes(c.zt)&&(this.L?(e.preventDefault(),t.set("#card-layer",{overflow:"hidden"}),t.set(this.M,{zIndex:1e3}),t.to(this.M,{duration:.5,u:"power4.inOut",scale:3})):this.slot===o.tt&&(e.preventDefault(),t.to([1,2,3,4,5].slice(o.tt).map((t=>c.St[t].M)),{duration:.5,u:"expo",opacity:.1}),t.to(this.M,{duration:.5,u:"power4.inOut",boxShadow:"rgb(0 255 0) 0px 0px 30px",scale:1.2})))}bt(e){["CardsDealt","CardsRevealed"].includes(c.zt)&&(e.preventDefault(),t.set("#card-layer",{overflow:"visible"}),t.to(Object.values(c.St).map((t=>t.M)),{duration:.5,u:"power4.inOut",boxShadow:"rgb(0 255 0) 0px 0px 0px",scale:1,opacity:1}))}}