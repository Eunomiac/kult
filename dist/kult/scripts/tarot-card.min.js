import{gsap as t,Flip as e,MotionPathPlugin as s,RoughEase as r}from"./external/greensock/all.js";import i from"./utilities.js";import a from"./constants.js";import{SessionData as h,SetPhase as n,Update as o}from"./kult-tarot.js";import c from"./tarot-deck.js";export default class u{static t(){t.i({name:"cardWander",effect:e=>{const s=t.timeline();return s.to(e,{x:(e,s)=>t.h(s,"x")+t.o.random(-150,150),u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}}),s.to(e,{y:(e,s)=>t.h(s,"y")+t.o.random(-50,50),u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}},0),s}}),t.i({name:"cardWanderHoverOn",effect:r=>{[r]=[r].flat();const i=e.getState(r,"boxShadow"),{x:a,y:h}=s.g($(r).parent()[0],"#control-layer",{x:t.h(r,"x"),y:t.h(r,"y")});$(r).appendTo("#control-layer"),t.set(r,{$:0,scale:3,boxShadow:"rgb(255 166 33) 0px 0px 10px",x:a,y:h,z:500});const n=c.k(r);return n.O=e.from(i,{duration:.5,u:"power2.out",absolute:!0,v:!0,j:!0,scale:!0}),n.O}}),t.i({name:"cardWanderHoverOff",effect:t=>{[t]=[t].flat();return c.k(t).O.reverse()}})}constructor(t,e,s){this.S=t,this.H=e,this.B=a.F.height,this.I=a.F.width,this.U=s,this.W=this.Z.x,this._=this.Z.y,this.D=e*(a.P/67),[this.C]=$(`<div id="${this.id}" class="tarot-card tarot-card-main tarot-card-${this.Z.type}" data-card-num="${this.M}"></div>`).appendTo("#card-layer")}get Z(){return this.U}get x(){return this.W=this.W??this.Z.x}get y(){return this._=this._??this.Z.y}get z(){return this.D=this.D??this.Z.z}get height(){return this.B}get width(){return this.I}get id(){return`card-main-${this.Z.type}-${this.M}`}get selector(){return`#${this.id}`}get M(){return this.H}get N(){return this.C??!1}get R(){return this.q=this.q??i.A(`${this.Z.type}/card-back-${t.o.random(1,a.G[this.Z.type],1)}.webp`)}get slot(){return this.J}set slot(t){this.J=t,this.x=a.K[t].x,this.y=a.K[t].y}get L(){return this.T?i.A(this.S.V):this.R}get T(){return h.X[this.slot]?.T}set T(t){h.X[this.slot].T=Boolean(t)}get Y(){return this.T||!h.tt?0:Math.max(0,this.slot-h.tt)}et(e){if(h.st)return!1;switch(h.rt){case a.it:return e.preventDefault(),!0;case a.ht:if(e.preventDefault(),this.slot===h.tt)this.nt();else{const e=h.X[h.tt].F.selector,s=Object.values(h.X).filter((({T:t})=>!t)).map((({F:t})=>t.selector)).join(", ");t.ct.ot(s),t.ct.ut(e)}}return!0}dt(e){if(h.st)return!1;switch(e.preventDefault(),h.rt){case"cardsInOrbit":{this.lt={x:t.h(this.N,"x"),y:t.h(this.N,"y"),z:t.h(this.N,"z")},[this.xt]=$(this.N).parent();const[e]=$("#control-layer"),{x:r,y:i}=s.g(this.xt,e,{x:t.h(this.N,"x"),y:t.h(this.N,"y")}),{z:a}=t.h(this.N,"z")+t.h(e,"z")-t.h(this.xt,"z");return $(this.N).appendTo(e),t.gt(this.N,{x:r,y:i,z:a},{$:-45,scale:3,boxShadow:"rgb(255 166 33) 0px 0px 10px",duration:.5,u:"power2.out"})}case"cardsDealt":{const e={};if(this.T){switch(this.slot){case 2:e.x="+="+a.F.width/3;break;case 3:e.y="+="+a.F.height/3;break;case 4:e.x="-="+a.F.width/3;break;case 5:e.y="-="+a.F.height/3}this.O=t.to(this.N,{...e,scale:3,duration:.5,u:"power4.inOut"})}else this.slot===h.tt&&(this.O=t.to(this.N,{z:"+=50",duration:.5,u:"power4.inOut",boxShadow:"rgb(0 255 0) 0px 0px 30px",scale:1.2}))}}return!0}yt(e){switch(e.preventDefault(),h.rt){case"cardsInOrbit":{$(this.N).appendTo(this.xt);const{x:e,y:r}=s.g($(this.N).parent()[0],this.xt,{x:t.h(this.N,"x"),y:t.h(this.N,"y")}),{z:i}=t.h(this.N,"z")+t.h(this.xt,"z")-t.h($(this.N).parent()[0],"z");return $(this.N).appendTo(this.xt),t.gt(this.N,{x:e,y:r,z:i},{$:0,scale:1,boxShadow:"none",duration:.5,u:"power2.out"})}case"cardsDealt":return this.O?.reverse();default:return!1}}ft(){t.set(this.N,{$t:-50,bt:-50,x:this.x,y:this.y,z:this.z,height:this.height,width:this.width,background:this.L,pointerEvents:"all",opacity:0,zt:!0})}nt(e){$(this.N).off("click mouseenter"),this.T=!0,t.to(this.N,{duration:0,u:"circ",background:this.L}),5===this.slot&&t.to("#card-layer",{x:`-=${h.X[2].wt.x-.5*a.F.width-a.padding.x}px`,duration:2,u:"expo4"})}}