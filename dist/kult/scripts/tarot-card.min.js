import{gsap as t,Flip as i,MotionPathPlugin as s,RoughEase as e}from"./external/greensock/all.js";import r from"./utilities.js";import a from"./constants.js";import{SessionData as h,SetPhase as n,Update as o,ghostPopText as c}from"../kult.js";import d from"./tarot-deck.js";export default class u{static t(){t.i({name:"cardWander",effect:i=>{const s=t.timeline();return s.to(i,{x:(i,s)=>t.h(s,"x")+t.o.random(-150,150),u:"sine.inOut",duration:3,l:{repeat:-1,g:!0,p:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}}),s.to(i,{y:(i,s)=>t.h(s,"y")+t.o.random(-50,50),u:"sine.inOut",duration:3,l:{repeat:-1,g:!0,p:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}},0),s}})}constructor(t,i,s){this.m=t,this.k=i,this.$=a.v.height,this.S=a.v.width,this.O=t.j,this.I=t.j.toLowerCase()in a.C.P?"minor":"major",this.M=s,this.Z=this.B.x,this.D=this.B.y,this.R=i*(a.X/67),[this._]=$(`<div id="${this.id}" class="tarot-card tarot-card-main tarot-card-${this.B.type}" data-card-num="${this.F}"></div>`).appendTo("#card-layer")}get B(){return this.M}get data(){return this.m}get x(){return this.Z=this.Z??this.B.x}get y(){return this.D=this.D??this.B.y}get z(){return this.R=this.R??this.B.z}get height(){return this.$}get width(){return this.S}get id(){return`card-main-${this.B.type}-${this.F}`}get selector(){return`#${this.id}`}get F(){return this.k}get H(){return this._??!1}get T(){return this.U=this.U??r.G(`${this.B.type}/card-back-${t.o.random(1,a.N[this.B.type],1)}.webp`)}get name(){return this.data.name}get j(){return this.O.toLowerCase()}get W(){return this.I}get q(){return this.data.q}get slot(){return this.A}set slot(t){this.A=t,this.Z=a.J[t].x,this.D=a.J[t].y,this.R=0}get angle(){return!!this.K&&r.L(this.K,t.h($(this.H).parent()[0],"rotationZ"))}get V(){return this.Y?r.G(this.m.tt):this.T}get Y(){return h.it[this.slot]?.Y}set Y(t){h.it[this.slot].Y=Boolean(t)}get st(){return this.Y||!h.et?0:Math.max(0,this.slot-h.et)}get rt(){return this.Y?Object.entries(this.m.ht).filter((([t,i])=>h.ht.nt[t])).map((([t,i])=>i)).flat():[]}ot(){this.Z=t.h(this.H,"x"),this.D=t.h(this.H,"y"),this.R=t.h(this.H,"z"),[this.ct]=$(this.H).parent()}dt(i){if(h.ut)return!1;switch(h.lt){case"cardsInOrbit":return i.preventDefault(),this.gt(),!0;case"cardsDealt":i.preventDefault(),this.slot===h.et?this.bt():t.xt.ft(h.it[h.et].v.H,{z:40})}return!0}kt(i){if(h.ut)return!1;switch(i.preventDefault(),h.lt){case"cardsInOrbit":/rotation-container/.test($(this.H).parent()[0].id)&&(t.yt([this.H,$(this.H).parent()]),this.ot(),this.$t=parseInt(this.angle),this.wt=t.vt(this.H,{filter:"none"},{z:Math.abs(this.$t)>115?400:250,width:1.5*a.v.width,height:Math.abs(this.$t)>115?a.v.height+r.zt(50,"vh"):1.25*a.v.height,backgroundColor:"transparent",St:Math.abs(this.$t)>115?-15:0,filter:"brightness(1.5) saturate(1.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",u:"power2.out",duration:.5,Ot:this,jt(){Math.abs(this.$t)>115?t.set(this.H,{backgroundPosition:"center bottom"}):t.set(this.H,{backgroundPosition:"center center"})}}));break;case"cardsDealt":case"cardsRevealed":if(this.Y){if(this.It)return!1;const{title:t,Pt:i}=a.styleMap[this.j];if(t.textShadow=r.Ct(t.textShadow,4,", "),i.textShadow=r.Ct(i.textShadow,2,", "),"major"===this.W){const[s,e]=this.q.split(/\s+of\s+/);c(this.name,this,0,25,{Mt:t}),e?(c(`${s} of`,this,95,120,{Mt:i},{delay:.5}),c(e,this,105,100,{Mt:t},{delay:.75})):c(s,this,105,100,{Mt:i},{delay:.5})}else c(this.q,this,0,25,{Mt:t}),c(`the ${this.name}`,this,95,25,{Mt:i})}else this.slot===h.et&&(this.Zt=t.timeline().to(this.H,{z:"+="+a.v.height/2,duration:.5,u:"power4.inOut",scale:1.2},0))}return!0}Bt(i){switch(i.preventDefault(),h.lt){case"cardsInOrbit":return!!/rotation-container/.test($(this.H).parent()[0].id)&&t.to(this.H,{z:()=>150+t.o.random(0,50),width:a.v.width,height:a.v.height,backgroundColor:"transparent",St:0,filter:"brightness(0.4) saturate(0.5) drop-shadow(30px 30px 10px rgba(0,0,0,0.7))",outline:"none",boxShadow:"none",u:"power2.out",duration:.5,delay:.25,Ot:this,Dt(){t.set(this.H,{backgroundPosition:"center center"}),/rotation-container/.test($(this.H).parent()[0].id)&&t.xt.Et(this.H),t.yt(".rotation-container"),t.xt.Rt("#rotation-container-0",{Xt:"+=360",delay:0}),t.xt.Rt("#rotation-container-1",{Xt:"-=360",delay:0})}});case"cardsDealt":case"cardsRevealed":return this.Zt?.reverse();default:return!1}}_t(){t.set(this.H,{Ft:-50,Ht:-50,x:this.x,y:this.y,z:this.z,height:this.height,width:this.width,backgroundImage:this.V,backgroundSize:`${this.width}px ${this.height}px`,pointerEvents:"all",opacity:0,Tt:!0}),$(this.H).click(this.dt.bind(this)),$(this.H).hover(this.kt.bind(this),this.Bt.bind(this))}gt(){const s=h.Ut;if(s){h.it[s].v=this,this.slot=s,t.yt(this.H);const e=i.getState(this.H,"boxShadow, filter, rotationZ");$(this.H).appendTo("#card-layer"),t.set(this.H,{St:0,Xt:0,z:0,height:a.v.height,width:a.v.width,scale:1,boxShadow:"5px 5px 5px rgba(0,0,0,0.4)",filter:"none",...h.it[s].Gt}),i.from(e,{duration:2,u:"expo.out",absolute:!0,Nt:!0,Wt:!0,scale:!0,Ot:this,Dt(){t.set(this.H,{backgroundPosition:"center center"}),5===s&&(t.yt(".canvas-layer, .canvas-layer *"),t.set(".tarot-card-main",{pointerEvents:"all"}),n(a.At.qt))}})}}bt(i){this.Y=!0,h.ht.Jt[this.slot]=this.rt,t.to(this.H,{duration:0,u:"circ",backgroundImage:this.V,Ot:this,Dt(){5===this.slot&&(this.Zt?.reverse(),n(a.At.Kt))}})}}