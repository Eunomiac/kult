import{gsap as t,Flip as e,MotionPathPlugin as s,RoughEase as i}from"./external/greensock/all.js";import r from"./utilities.js";import a from"./constants.js";import{SessionData as h,SetPhase as n,Update as o}from"./kult-tarot.js";import c from"./tarot-deck.js";export default class u{static t(){t.i({name:"cardWander",effect:e=>{const s=t.timeline();return s.to(e,{x:(e,s)=>t.h(s,"x")+t.o.random(-150,150),u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}}),s.to(e,{y:(e,s)=>t.h(s,"y")+t.o.random(-50,50),u:"sine.inOut",duration:3,l:{repeat:-1,p:!0,m:3,u:"rough({ strength: 0.5, points: 20, template: none.inOut, taper: none, randomize: true, clamp: false })",from:"random"}},0),s}})}constructor(t,e,s){this.g=t,this.$=e,this.k=a.O.height,this.j=a.O.width,this.v=s,this.S=this.B.x,this.F=this.B.y,this.I=e*(a.U/67),[this.Z]=$(`<div id="${this.id}" class="tarot-card tarot-card-main tarot-card-${this.B.type}" data-card-num="${this._}"></div>`).appendTo("#card-layer")}get B(){return this.v}get x(){return this.S=this.S??this.B.x}get y(){return this.F=this.F??this.B.y}get z(){return this.I=this.I??this.B.z}get height(){return this.k}get width(){return this.j}get id(){return`card-main-${this.B.type}-${this._}`}get selector(){return`#${this.id}`}get _(){return this.$}get C(){return this.Z??!1}get D(){return this.H=this.H??r.P(`${this.B.type}/card-back-${t.o.random(1,a.X[this.B.type],1)}.webp`)}get slot(){return this.M}set slot(t){this.M=t,this.x=a.N[t].x,this.y=a.N[t].y}get R(){return this.W?r.P(this.g.q):this.D}get W(){return h.A[this.slot]?.W}set W(t){h.A[this.slot].W=Boolean(t)}get G(){return this.W||!h.J?0:Math.max(0,this.slot-h.J)}K(e){if(h.L)return!1;switch(h.T){case a.V:return e.preventDefault(),!0;case a.Y:if(e.preventDefault(),this.slot===h.J)this.tt();else{const e=h.A[h.J].O.selector,s=Object.values(h.A).filter((({W:t})=>!t)).map((({O:t})=>t.selector)).join(", ");t.st.et(s),t.st.it(e)}}return!0}rt(e){if(h.L)return!1;switch(e.preventDefault(),h.T){case"cardsInOrbit":{t.ht(this.C),this.nt={x:t.h(this.C,"x"),y:t.h(this.C,"y"),z:t.h(this.C,"z")},[this.ot]=$(this.C).parent();const[e]=$("#control-layer"),{x:i,y:r}=s.ct(this.ot,e,{x:t.h(this.C,"x"),y:t.h(this.C,"y")});return $(this.C).appendTo(e),t.ut(this.C,{x:i,y:r,dt:0},{lt:-45,scale:3,boxShadow:"rgb(255 166 33) 0px 0px 10px",duration:.5,u:"power2.out"})}case"cardsDealt":{const e={};if(this.W){switch(this.slot){case 2:e.x="+="+a.O.width/3;break;case 3:e.y="+="+a.O.height/3;break;case 4:e.x="-="+a.O.width/3;break;case 5:e.y="-="+a.O.height/3}this.gt=t.to(this.C,{...e,scale:3,duration:.5,u:"power4.inOut",xt:this,yt(e,s){t.st.ft(this.C)}})}else this.slot===h.J&&(this.gt=t.to(this.C,{z:"+=50",duration:.5,u:"power4.inOut",boxShadow:"rgb(0 255 0) 0px 0px 30px",scale:1.2}))}}return!0}$t(e){switch(e.preventDefault(),h.T){case"cardsInOrbit":{$(this.C).appendTo(this.ot);const{x:e,y:i}=s.ct($(this.C).parent()[0],this.ot,{x:t.h(this.C,"x"),y:t.h(this.C,"y")}),r=-1*t.h(this.ot,"rotationZ");return $(this.C).appendTo(this.ot),t.ut(this.C,{x:e,y:i,dt:r},{lt:0,scale:1,boxShadow:"none",duration:.5,u:"power2.out"})}case"cardsDealt":return this.gt?.reverse();default:return!1}}bt(){t.set(this.C,{kt:-50,wt:-50,x:this.x,y:this.y,z:this.z,height:this.height,width:this.width,background:this.R,pointerEvents:"all",opacity:0,Ot:!0})}tt(e){$(this.C).off("click mouseenter"),this.W=!0,t.to(this.C,{duration:0,u:"circ",background:this.R}),5===this.slot&&t.to("#card-layer",{x:`-=${h.A[2].zt.x-.5*a.O.width-a.padding.x}px`,duration:2,u:"expo4"})}}