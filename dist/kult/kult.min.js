import{gsap as t,ExpoScaleEase as e,Flip as o,MotionPathPlugin as a,RoughEase as r,SlowMo as n,SplitText as s}from"./scripts/external/greensock/all.js";import i from"./scripts/utilities.js";import c from"./scripts/constants.js";import l from"./scripts/debug.js";import d from"./scripts/tarot-deck.js";import p from"./scripts/tarot-card.js";t.t(e,o,a,r,n,s),t.o({i:!0,l:!1}),t.p({name:"slowRotate",effect:(e,o)=>(e=e.filter((t=>/rotation-container/.test(t.id))),t.to(e,{u:o.u,duration:o.duration,delay:o.delay,repeat:-1,h:"none",g:()=>t.set(`#${e[0].id} > .tarot-card-main`,{u:-1*t.m(e[0],"rotationZ")})})),v:{u:"+=360",duration:150,delay:1}}),t.p({name:"splashGhostText",k:!0,v:{duration:10,h:"none",delay:.5},effect:(e,o={})=>{t.set(e,{filter:"blur(0px) brightness(1) drop-shadow(20px 20px 10px black)"});const[a]=$(e[0]).parents("div.ghost-container"),r=.1*e.length;return t.timeline({delay:o.delay}).T(a,{x:"-="+.5*t.m(a,"width")},{x:`+=${t.m(a,"width")}`,duration:o.duration+r,h:"slow(0.1, 2, false)"}).T(e,{filter:"blur(20px) brightness(1) drop-shadow(20px 20px 10px black)"},{filter:"blur(0px) brightness(8) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,C:{j:.5,h:"none",start:"end"}},0).from(e,{duration:.1,opacity:0,h:"none",C:{O:.02,h:"power2"}},0).to(e,{filter:"blur(30px) brightness(10) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,C:{j:.5,h:"none",from:"end",P(){t.to(this.S()[0],{duration:.1,opacity:0,h:"none",X:"filter"})}}},o.duration-.2*o.duration/2+r-.5).$(t.F.random(.8,1.2))}});const u={I:!1,U:[],Z:!1,W:c.D.H,G:!0,get N(){return this.G?c.D.G:this.W},set N(t){this.W=t},R:{1:{A:!1,B:!1,K:c.M[1],_:!1,q:!1,J:!1},2:{A:!1,B:!1,K:c.M[2],_:!1,q:!1,J:!1},3:{A:!1,B:!1,K:c.M[3],_:!1,q:!1,J:!1},4:{A:!1,B:!1,K:c.M[4],_:!1,q:!1,J:!1},5:{A:!1,B:!1,K:c.M[5],_:!1,q:!1,J:!1}},q:{L:null,V:{1:[],2:[],3:[],4:[],5:[]},Y:[],tt:{et:!0,location:!0,organization:!0,ot:!0,rt:!0,item:!0},get next(){const e=0===u.q.Y.length,o=Object.entries(u.q.V).filter((([t,e])=>e.length)).map((([t])=>t));for(const t of o)u.q.Y.includes(t)||u.q.Y.unshift(t);if(0===u.q.Y.length)return!1;e&&(u.q.Y=t.F.nt(u.q.Y));const a=u.q.Y.shift();return u.q.Y.push(a),[a,t.F.random(u.q.V[a])]}},get st(){return[1,2,3,4,5].find((t=>this.R[t].A&&!1===this.R[t]._))},get it(){return[1,2,3,4,5].find((t=>!1===this.R[t].A))},get ct(){return Object.values(this.R).map((({A:t})=>t))}},h=(e=5,o=10)=>{u.q.L&&y(),u.q.L=setInterval((function(){const[e,a]=u.q.next||[];a&&function(e,o,a){const r=$('<span class="ghost-text"></span>').text(o).appendTo(`#ghost-slot-${e}`);t.set(r,{whiteSpace:"nowrap"});const n=parseInt(t.m(r[0],"width","px")),i=parseInt(t.m(r[0],"height","px"));console.log({lt:n,dt:i});const c=$(`<div class="ghost-container ghost-container-slot-${e}"></div>`).append(r).appendTo(`#ghost-slot-${e}`);t.set(c,{display:"blocK",ut:-50,ht:-50,height:i,width:n,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:t.F.random(.5*n,t.m(`#ghost-slot-${e}`,"width")-.5*n),y:t.F.random(.5*i,t.m(`#ghost-slot-${e}`,"height")-.5*i),z:0});const l=new s(r[0],{type:"chars,words,lines"});t.gt.yt(l.xt,{duration:a}).then((()=>$(c).remove()))}(e,a,o)}),1e3*e)},y=()=>{clearInterval(u.q.L),u.q.L=null,t.to(".ghost-text",{opacity:0,duration:.5,P(t,e){$(e).remove()}})};function g(e,{x:o,y:a,z:r}={}){o=o??c.M[1].x,a=a??c.M[1].y,r=r??300;const[n]=$('<span class="ghost-text ghost-banner"></span>').text(e).appendTo("#control-layer");t.set(n,{x:o,y:a,z:r,transformOrigin:"50% 50%"});const i=new s(n,{type:"chars,words,lines",position:"absolute"});t.gt.yt(i.xt,{x:o,y:a,ft:.25*t.m("#control-layer","width")}).then((()=>$(n).remove()))}const x=(t,e)=>{if(t=t in c.D?c.D[t]:t,Object.values(c.D).includes(t))switch(u.N=t,console.log(`*** SWITCHING PHASE TO: ${t}`),t){case c.D.H:return f();case c.D.bt:return b(e);case c.D.wt:return w();case c.D.vt:return v();default:return!0}return!1},m=()=>{},f=()=>{u.G=!0,t.timeline().set(".deck-box .face",{opacity:0}).T("#reading-section",{u:65},{u:0,duration:16,h:"back.out(2)"},0).T(".deck-box",{z:-25},{z:25,duration:2,C:{O:.5,from:"random",kt(){t.to(`#${this.S()[0].id} .face:not(.face-back)`,{opacity:1,h:"none",duration:3})}},P(){u.G=!1,g("Which of the Tarot will guide you?",{y:c.M[1].y-100})},h:"power2.out"},0).T("#reading-section",{scale:2},{scale:1,duration:16,h:"expoScale(2, 1, back.out(2))"},0).to("#blackout-layer",{opacity:0,duration:.5,$t:45,h:"sine",P(){$("#blackout-layer").remove()}},0).to(".canvas-layer:not(#control-layer)",{$t:45,duration:10,h:"elastic.out(1, 0.75)"},0)},b=({I:t})=>{u.G=!0,u.I=t,u.I.Tt()},w=()=>{u.G=!0,t.timeline().to("#reading-section",{perspective:1e3,y:"-=1.5vh",duration:7,scale:1},0).to("#over-layer",{scale:5,duration:2,h:"power2.out",P(){$("#over-layer > .rotation-container").remove(),t.set("#over-layer",{scale:1,$t:35})}},0).to(".canvas-layer:not(#over-layer):not(#control-layer)",{scale:1,$t:35,duration:7,h:"sine",P(){u.G=!1,g("The Core Card",{x:c.M[2].x}),h(7,10)}},0).then((()=>{for(let e=1;e<=5;e++){const o=$(`<div id="ghost-slot-${e}" class="ghost-zone"></div>`).appendTo("#over-layer");t.set(o,{ut:-50,ht:-50,height:1.25*c.A.height,width:2*c.A.width,position:"absolute",pointerEvents:"none",display:"block",x:c.M[e].x,y:c.M[e].y+i.Ct(13,"vh"),z:150,$t:-1*t.m("#over-layer","rotationX")})}}))},v=()=>{u.G=!0,t.timeline().to(".canvas-layer:not(#control-layer)",{x:"-=30vw",$t:"-=10",h:"back.out(2)",duration:3,P(){u.G=!1}},0).to(".ghost-zone",{x:"+=5vw",h:"back.out(2)",duration:3},0)},k=()=>{$(".canvas-layer *").remove(),0===$("#blackout-layer").length&&$('<div id="blackout-layer"></div>').prependTo("body"),t.set("#blackout-layer, .canvas-layer",{ut:-50,ht:-50,x:c.M[1].x,y:c.M[1].y,z(t,e){switch(e.id){case"blackout-layer":return 500;case"background-layer":return c.zt.jt-2;case"under-layer":return c.zt.jt-1;case"card-layer":return c.zt.jt;case"over-layer":return c.zt.jt+c.zt.Ot;default:return 0}},$t:(t,e)=>/control-layer/.test(e.id)?0:80,scale:1,Pt:!0});Object.keys(c.St);const e=Object.keys(c.St).map((t=>new d(t,u)));l.Xt&&e.forEach((t=>t.Ft=t.Ft.slice(0,l.Xt)));const[o,a]=i.It(e,((t,o)=>o<=Math.ceil(e.length/2)-1)),r=(t.m("#card-layer","width")-c.A.width*o.length-c.spacing.x*(o.length-1))/2,n=(t.m("#card-layer","width")-c.A.width*a.length-c.spacing.x*(a.length-1))/2;o.forEach(((t,e)=>{t.x=r+.5*c.A.width+e*(c.spacing.x+c.A.width),t.y=Number(c.A.height),u.U.push(t),t.Ut(1)})),a.forEach(((t,e)=>{t.x=n+.5*c.A.width+e*(c.spacing.x+c.A.width),t.y=2.5*c.A.height,u.U.push(t),t.Ut(2)}))},T=()=>{d.Zt(),p.Zt(),f()};console.clear(),k(),$(document).ready((()=>{T()}));export{k as InitializeDomElements,T as Initialize,u as SessionData,x as SetPhase,m as Update};