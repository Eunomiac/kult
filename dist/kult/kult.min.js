import{gsap as e,ExpoScaleEase as t,Flip as o,MotionPathPlugin as a,RoughEase as r,SlowMo as n,SplitText as s}from"./scripts/external/greensock/all.js";import i from"./scripts/utilities.js";import c from"./scripts/constants.js";import l from"./scripts/debug.js";import p from"./scripts/tarot-deck.js";import d from"./scripts/tarot-card.js";e.t(t,o,a,r,n,s),e.o({i:!0,l:!1}),e.p({name:"slowRotate",effect:(t,o)=>(t=t.filter((e=>/rotation-container/.test(e.id))),e.to(t,{u:o.u,duration:o.duration,delay:o.delay,repeat:-1,h:"none",g:()=>e.set(`#${t[0].id} > .tarot-card-main`,{u:-1*e.m(t[0],"rotationZ")})})),v:{u:"+=360",duration:150,delay:1}}),e.p({name:"splashGhostText",$:!0,v:{duration:10,h:"none",delay:.5},effect:(t,o={})=>{e.set(t,{filter:"blur(0px) brightness(1) drop-shadow(20px 20px 10px black)"});const[a]=$(t[0]).parents("div.ghost-container"),r=.1*t.length;return e.timeline({delay:o.delay}).T(a,{x:"-="+.5*e.m(a,"width")},{x:`+=${e.m(a,"width")}`,duration:o.duration+r,h:"slow(0.1, 2, false)"}).T(a,{z:10,scale:1},{z:"+=100",y:"-=200",scale:2.5,opacity:.5,h:"expo.in",duration:o.duration+r-.5*(o.duration+r)},.5*(o.duration+r)).T(t,{filter:"blur(20px) brightness(1) drop-shadow(20px 20px 10px black)"},{filter:"blur(0px) brightness(8) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,C:{P:.5,h:"none",start:"end"}},0).from(t,{duration:.1,opacity:0,h:"none",C:{j:.02,h:"power2"}},0).to(t,{filter:"blur(30px) brightness(10) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,C:{P:.5,h:"none",from:"end",O(){e.to(this.S()[0],{duration:.1,opacity:0,h:"none",X:"filter"})}}},o.duration-.2*o.duration/2+r-.5).k(e.F.random(.8,1.2))}}),e.p({name:"splashPopText",$:!0,v:{duration:5,h:"expo.inOut",delay:0},effect:(t,o={})=>{e.set(t,{filter:"blur(0px) drop-shadow(20px 20px 10px black)"});const[a]=$(t[0]).parents("div.pop-container"),[r]=$(a).parent(),n=p.I(r),s=.1*t.length/2;return e.timeline({delay:o.delay,O(){n.U=!1}}).to(a,{z:"+=100",scale:3,duration:o.duration+s,h:"slow(0.1, 1, false)"}).T(t,{filter:"blur(20px) drop-shadow(20px 20px 30px black)"},{filter:"blur(0px) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,C:{P:.5,h:"none",start:"edges"}},0).from(t,{duration:.1,opacity:0,h:"none",C:{j:.02,h:"power2",start:"center"}},0).to(t,{filter:"blur(30px) drop-shadow(20px 20px 30px black)",duration:.2*o.duration/2,h:o.h,C:{P:.5,h:"none",from:"center",O(){e.to(this.S()[0],{duration:.1,opacity:0,h:"none",X:"filter"})}}},o.duration-.2*o.duration/2+s-.5)}});const u={Z:!1,D:[],W:!1,A:c.H.G,K:!0,get N(){return this.K?c.H.K:this.A},set N(e){this.A=e},R:{1:{B:!1,L:!1,M:c._[1],q:!1,J:!1,V:!1},2:{B:!1,L:!1,M:c._[2],q:!1,J:!1,V:!1},3:{B:!1,L:!1,M:c._[3],q:!1,J:!1,V:!1},4:{B:!1,L:!1,M:c._[4],q:!1,J:!1,V:!1},5:{B:!1,L:!1,M:c._[5],q:!1,J:!1,V:!1}},J:{Y:null,ee:{1:[],2:[],3:[],4:[],5:[]},te:[],oe:{ae:!0,location:!0,organization:!0,re:!0,ne:!0,item:!0},get next(){const t=0===u.J.te.length,o=Object.entries(u.J.ee).filter((([e,t])=>t.length)).map((([e])=>e));for(const e of o)u.J.te.includes(e)||u.J.te.unshift(e);if(0===u.J.te.length)return!1;t&&(u.J.te=e.F.se(u.J.te));const a=u.J.te.shift();return u.J.te.push(a),[a,e.F.random(u.J.ee[a])]}},get ie(){return[1,2,3,4,5].find((e=>this.R[e].B&&!1===this.R[e].q))},get ce(){return[1,2,3,4,5].find((e=>!1===this.R[e].B))},get le(){return Object.values(this.R).map((({B:e})=>e))}},h=(t=5,o=10)=>{x(),function a(){u.J.pe=e.de(t,a);const[r,n]=u.J.next||[];n&&function(t,o,a){const r=$('<span class="ghost-text"></span>').text(o).appendTo(`#ghost-slot-${t}`);e.set(r,{whiteSpace:"nowrap"});const n=parseInt(e.m(r[0],"width","px")),i=parseInt(e.m(r[0],"height","px")),c=$(`<div class="ghost-container ghost-container-slot-${t}"></div>`).append(r).appendTo(`#ghost-slot-${t}`);e.set(c,{display:"blocK",ue:-50,he:-50,height:i,width:n,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:e.F.random(.5*n,e.m(`#ghost-slot-${t}`,"width")-.5*n),y:e.F.random(.5*i,e.m(`#ghost-slot-${t}`,"height")-.5*i),z:0});const l=new s(r[0],{type:"chars,words,lines"});e.ye.xe(l.ge,{duration:a}).then((()=>$(c).remove()))}(r,n,o)}()},x=()=>{u.J.pe?.be(),delete u.J.pe,e.to(".ghost-text",{opacity:0,duration:.25,O(e,t){$(t).remove()}})};function y(t,o,a,r=0,{fe:n={},me:i={}}={}){o.U=!0;const l=$('<span class="pop-text"></span>').text(t).appendTo(o.we);e.set(l,{whiteSpace:"nowrap",...n,textAlign:"center"});const p=parseInt(e.m(l[0],"width","px")),d=$(`<div class="pop-container pop-container-slot-${o.slot}"></div>`).append(l).appendTo(o.we);e.set(d,{display:"block",ue:-50,he:-50,width:p,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:c.B.width/2,y:c.B.height*(a/100),z:r,ve:-25});const u=new s(l[0],{type:"chars,words,lines"});e.ye.$e(u.ge,i).then((()=>$(d).remove()))}function g(t,{x:o,y:a,z:r}={}){o=o??c._[1].x,a=a??c._[1].y,r=r??300;const[n]=$('<span class="ghost-text ghost-banner"></span>').text(t).appendTo("#control-layer");e.set(n,{x:o,y:a,z:r,transformOrigin:"50% 50%"});const i=new s(n,{type:"chars,words,lines",position:"absolute"});e.ye.xe(i.ge,{x:o,y:a,ke:.25*e.m("#control-layer","width")}).then((()=>$(n).remove()))}const b=(e,t)=>{if(e=e in c.H?c.H[e]:e,Object.values(c.H).includes(e))switch(u.N=e,console.log(`*** SWITCHING PHASE TO: ${e}`),e){case c.H.G:return m();case c.H.Te:return w(t);case c.H.Ce:return v();case c.H.ze:return k();default:return!0}return!1},f=()=>{},m=()=>{u.K=!0,e.timeline().set(".deck-box .face",{opacity:0}).T("#reading-section",{u:65},{u:0,duration:16,h:"back.out(2)"},0).T(".deck-box",{z:-25},{z:25,duration:2,C:{j:.5,from:"random",Pe(){e.to(`#${this.S()[0].id} .face:not(.face-back)`,{opacity:1,h:"none",duration:3})}},O(){u.K=!1,g("Which of the Tarot will guide you?",{y:c._[1].y-100})},h:"power2.out"},0).T("#reading-section",{scale:2},{scale:1,duration:16,h:"expoScale(2, 1, back.out(2))"},0).to("#blackout-layer",{opacity:0,duration:.5,ve:45,h:"sine",O(){$("#blackout-layer").remove()}},0).to(".canvas-layer:not(#control-layer)",{ve:45,duration:10,h:"elastic.out(1, 0.75)"},0)},w=({Z:e})=>{u.K=!0,u.Z=e,u.Z.je()},v=()=>{u.K=!0,e.timeline().to("#reading-section",{perspective:1e3,y:"-=1.5vh",duration:7,scale:1},0).to("#over-layer",{scale:5,duration:2,h:"power2.out",O(){$("#over-layer > .rotation-container").remove(),e.set("#over-layer",{scale:1,ve:35})}},0).to(".canvas-layer:not(#over-layer):not(#control-layer)",{scale:1,ve:35,duration:7,h:"sine",O(){u.K=!1,g("The Core Card",{x:c._[2].x}),h(7,10)}},0).then((()=>{for(let t=1;t<=5;t++){const o=$(`<div id="ghost-slot-${t}" class="ghost-zone"></div>`).appendTo("#over-layer");e.set(o,{ue:-50,he:-50,height:1.25*c.B.height,width:2*c.B.width,position:"absolute",pointerEvents:"none",display:"block",x:c._[t].x,y:c._[t].y+i.Oe(13,"vh"),z:150,ve:-1*e.m("#over-layer","rotationX")})}}))},k=()=>{u.K=!0,e.timeline().to(".canvas-layer:not(#control-layer)",{x:"-=30vw",ve:"-=10",h:"back.out(2)",duration:3,O(){u.K=!1}},0).to(".ghost-zone",{x:"+=5vw",h:"back.out(2)",duration:3},0).to(".tarot-card-main",{scale:1,duration:.5,h:"sine"},0)},T=()=>{$(".canvas-layer *").remove(),0===$("#blackout-layer").length&&$('<div id="blackout-layer"></div>').prependTo("body"),e.set("#blackout-layer, .canvas-layer",{ue:-50,he:-50,x:c._[1].x,y:c._[1].y,z(e,t){switch(t.id){case"blackout-layer":return 500;case"background-layer":return c.Xe.Se-2;case"under-layer":return c.Xe.Se-1;case"card-layer":return c.Xe.Se;case"over-layer":return c.Xe.Se+c.Xe.Ee;default:return 0}},ve:(e,t)=>/control-layer/.test(t.id)?0:80,scale:1,Fe:!0});Object.keys(c.Ie);const t=Object.keys(c.Ie).map((e=>new p(e,u)));l.Ue&&t.forEach((e=>e.Ze=e.Ze.slice(0,l.Ue)));const[o,a]=i.De(t,((e,o)=>o<=Math.ceil(t.length/2)-1)),r=(e.m("#card-layer","width")-c.B.width*o.length-c.spacing.x*(o.length-1))/2,n=(e.m("#card-layer","width")-c.B.width*a.length-c.spacing.x*(a.length-1))/2;o.forEach(((e,t)=>{e.x=r+.5*c.B.width+t*(c.spacing.x+c.B.width),e.y=Number(c.B.height),u.D.push(e),e.We(1)})),a.forEach(((e,t)=>{e.x=n+.5*c.B.width+t*(c.spacing.x+c.B.width),e.y=2.5*c.B.height,u.D.push(e),e.We(2)}))},C=()=>{$('<button id="start-debug"></button>').prependTo("#debug-layer").click((()=>{console.log("CLICKED!"),l.initialize()})),e.set("#start-debug",{position:"absolute",top:0,left:0,height:50,width:50,border:"none",outline:"none",opacity:0,pointerEvents:"all"}),p.Ae(),d.Ae(),m()};console.clear(),T(),$(document).ready((()=>{C()}));export{T as InitializeDomElements,C as Initialize,u as SessionData,b as SetPhase,f as Update,y as ghostPopText};