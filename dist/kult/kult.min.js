import{gsap as e,ExpoScaleEase as t,Flip as o,MotionPathPlugin as a,RoughEase as r,SlowMo as n,SplitText as s}from"./scripts/external/greensock/all.js";import i from"./scripts/utilities.js";import c from"./scripts/constants.js";import l from"./scripts/debug.js";import p from"./scripts/tarot-deck.js";import d from"./scripts/tarot-card.js";e.t(t,o,a,r,n,s),e.o({i:!0,l:!1}),e.p({name:"slowRotate",effect:(t,o)=>(t=t.filter((e=>/rotation-container/.test(e.id))),e.to(t,{u:o.u,duration:o.duration,delay:o.delay,repeat:-1,h:"none",g:()=>e.set(`#${t[0].id} > .tarot-card-main`,{u:-1*e.m(t[0],"rotationZ")})})),v:{u:"+=360",duration:150,delay:1}}),e.p({name:"wiggleCard",$:!0,v:{z:20,angle:5,duration:.2},effect:(t,o={})=>e.timeline().to(t,{z:o.z,T:o.angle,C:o.angle,duration:.5,repeat:1,I:!0,h:"circ.out"},0).to(t,{T:-o.angle,repeat:1,I:!0,duration:.25,O:.25,h:"sine.inOut"},0).to(t,{C:-o.angle,repeat:1,I:!0,duration:.25,O:.25,h:"sine.inOut"},.25).to(t,{T:0,C:0,duration:.15,h:"power2.out"},">").k(1/o.duration)}),e.p({name:"splashGhostText",$:!0,v:{duration:10,h:"none",delay:0,P:{min:0,max:1.5},X:{min:.5,max:1}},effect:(t,o={})=>{e.set(t,{filter:"blur(0px) drop-shadow(20px 20px 10px black)"});const[a]=$(t[0]).parents("div.ghost-container"),r=parseInt(e.m(a,"width","px")),n=parseInt(e.m(a,"height","px")),s=.1*t.length;return e.timeline({delay:o.delay}).j(a,{x:e.S.random(o.F*r,o.U*r),y:e.S.random(-.5*n,.5*n),z:e.S.random(150,250,1)},{x:"+="+(o.U*r-o.F*r),duration:o.duration+s,h:"slow(0.1, 2, false)"},0).to(a,{z:"+=500",y:"-=200",h:"expo.in",duration:o.duration+s-.5*(o.duration+s)},.5+.5*(o.duration+s)).j(t,{filter:"blur(20px) drop-shadow(20px 20px 10px black)",opacity:0},{filter:"blur(0px) drop-shadow(20px 20px 10px black)",opacity:1,duration:.2*o.duration/2,h:o.h,Z:{D:.5,h:"none",from:"end"}},0).to(t,{filter:"blur(30px) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,Z:{D:.5,h:"none",from:"end",M(){e.to(this.K()[0],{duration:.1,opacity:0,h:"none",W:"filter"})}}},o.duration-.2*o.duration/2+s).to(t,{x:"+=200",y:"-=300",scale:2,duration:3,h:"expo.in",Z:{D:o.duration+s-.5*(o.duration+s),h:"expo.out",from:"end"}},o.duration-.2*o.duration/2+s-1).k(e.S.random(.8,1.2))}}),e.p({name:"splashPopText",$:!0,v:{duration:5,h:"expo.inOut",delay:0},effect:(t,o={})=>{e.set(t,{filter:"blur(0px) drop-shadow(20px 20px 10px black)"});const[a]=$(t[0]).parents("div.pop-container"),[r]=$(a).parent(),n=p.Y(r),s=.1*t.length/2;return e.timeline({delay:o.delay,M(){n.A=!1}}).to(a,{z:"+=100",scale:3,duration:o.duration+s,h:"slow(0.1, 1, false)"}).j(t,{filter:"blur(20px) drop-shadow(20px 20px 30px black)"},{filter:"blur(0px) drop-shadow(20px 20px 10px black)",duration:.2*o.duration/2,h:o.h,Z:{D:.5,h:"none",start:"edges"}},0).from(t,{duration:.1,opacity:0,h:"none",Z:{G:.02,h:"power2",start:"center"}},0).to(t,{filter:"blur(30px) drop-shadow(20px 20px 30px black)",duration:.2*o.duration/2,h:o.h,Z:{D:.5,h:"none",from:"center",M(){e.to(this.K()[0],{duration:.1,opacity:0,h:"none",W:"filter"})}}},o.duration-.2*o.duration/2+s-.5)}});const u={H:!1,N:[],R:!1,B:c._.L,q:!0,get J(){return this.q?c._.q:this.B},set J(e){this.B=e},V:{1:{ee:!1,te:!1,oe:c.ae[1],re:!1,ne:!1,se:!1},2:{ee:!1,te:!1,oe:c.ae[2],re:!1,ne:!1,se:!1},3:{ee:!1,te:!1,oe:c.ae[3],re:!1,ne:!1,se:!1},4:{ee:!1,te:!1,oe:c.ae[4],re:!1,ne:!1,se:!1},5:{ee:!1,te:!1,oe:c.ae[5],re:!1,ne:!1,se:!1}},ne:{ie:null,ce:{1:[],2:[],3:[],4:[],5:[]},le:[],pe:{de:!0,location:!0,organization:!0,ue:!0,xe:!0,item:!0},get next(){const t=0===u.ne.le.length,o=Object.entries(u.ne.ce).filter((([e,t])=>t.length)).map((([e])=>e));for(const e of o)u.ne.le.includes(e)||u.ne.le.unshift(e);if(0===u.ne.le.length)return!1;t&&(u.ne.le=e.S.he(u.ne.le));const a=u.ne.le.shift();return u.ne.le.push(a),[a,e.S.random(u.ne.ce[a])]}},get ye(){return[1,2,3,4,5].find((e=>this.V[e].ee&&!1===this.V[e].re))},get ge(){return[1,2,3,4,5].find((e=>!1===this.V[e].ee))},get me(){return Object.values(this.V).map((({ee:e})=>e))}},x=(t=5,o=10)=>{h(),function a(){u.ne.fe=e.be(t,a);const[r,n]=u.ne.next||[];n&&function(t,o,a){const[r]=$(`#ghost-slot-${t}`),n=parseInt(e.m(r,"width","px")),i=parseInt(e.m(r,"height","px")),[c]=$('<span class="ghost-text"></span>').html(o).appendTo(r);e.set(c,{whiteSpace:"nowrap"});const l=parseInt(e.m(c,"width","px")),p=parseInt(e.m(c,"height","px")),[d]=$(`<div class="ghost-container ghost-container-slot-${t}"></div>`).append(c).appendTo(r);e.set(d,{display:"blocK",we:-50,ve:-50,height:p,width:l,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:n/2,y:i/2,z:0,T:-1*e.m("#over-layer","rotationX")});const x=new s(c,{type:"chars",position:"absolute"});e.timeline({M(){$(d).remove()}}).ke(x.Te,{duration:a},0).$e(u.V[t].ee.Ce,{z:20,angle:5,duration:.2},.5)}(r,n,o)}()},h=()=>{u.ne.fe?.Ie(),delete u.ne.fe,e.to(".ghost-text",{opacity:0,duration:.25,M(e,t){$(t).remove()}})};function y(t,o,a,r=0,{ze:n={},Oe:i={}}={}){o.A=!0;const l=$('<span class="pop-text"></span>').text(t).appendTo(o.Ce);e.set(l,{whiteSpace:"nowrap",...n,textAlign:"center"});const p=parseInt(e.m(l[0],"width","px")),d=$(`<div class="pop-container pop-container-slot-${o.slot}"></div>`).append(l).appendTo(o.Ce);e.set(d,{display:"block",we:-50,ve:-50,width:p,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:c.ee.width/2,y:c.ee.height*(a/100),z:r,T:-25});const u=new s(l[0],{type:"chars,words,lines"});e.Xe.Pe(u.Te,i).then((()=>$(d).remove()))}function g(t,o="middle",a={}){const[r]=$('<span class="ghost-text ghost-banner"></span>').html(t).appendTo("#control-layer");e.set(r,{whiteSpace:"nowrap",...a});const n=parseInt(e.m(r,"width","px")),i=parseInt(e.m(r,"height","px")),[c]=$('<div class="ghost-container ghost-banner-container"></div>').append(r).appendTo("#control-layer");e.set(c,{display:"blocK",we:-50,ve:-50,height:i,width:n,position:"absolute",pointerEvents:"none",transformOrigin:"50% 50%",x:parseInt(e.m("#control-layer","width","px"))/2,y:{top:0,je:parseInt(e.m("#control-layer","height","px"))/2,bottom:parseInt(e.m("#control-layer","height","px"))}[o]});const l=new s(r,{type:"chars,words,lines",position:"absolute"});return e.Xe.ke(l.Te,{F:-.3,U:.3}).then((()=>$(c).remove()))}const m=(e,t)=>{if(e=e in c._?c._[e]:e,Object.values(c._).includes(e))switch(u.J=e,console.log(`*** SWITCHING PHASE TO: ${e}`),e){case c._.L:return b();case c._.Se:return w(t);case c._.Ee:return v();case c._.Fe:return k();default:return!0}return!1},f=()=>{},b=()=>{u.q=!0,e.timeline().set(".deck-box .face",{opacity:0}).j("#reading-section",{u:65},{u:0,duration:16,h:"back.out(2)"},0).j(".deck-box",{z:-25},{z:25,duration:2,Z:{G:.5,from:"random",Ue(){e.to(`#${this.K()[0].id} .face:not(.face-back)`,{opacity:1,h:"none",duration:3})}},M(){u.q=!1,g("Which of the Tarot will guide you?",{y:c.ae[1].y-100})},h:"power2.out"},0).j("#reading-section",{scale:2},{scale:1,duration:16,h:"expoScale(2, 1, back.out(2))"},0).to("#blackout-layer",{opacity:0,duration:.5,T:45,h:"sine",M(){$("#blackout-layer").remove()}},0).to(".canvas-layer:not(#control-layer)",{T:45,duration:10,h:"elastic.out(1, 0.75)"},0)},w=({H:e})=>{u.q=!0,u.H=e,u.H.Ze()},v=()=>{u.q=!0,e.timeline().to("#reading-section",{perspective:1e3,y:"-=1.5vh",duration:7,scale:1},0).to("#over-layer",{scale:5,duration:2,h:"power2.out",M(){$("#over-layer > .rotation-container").remove(),e.set("#over-layer",{scale:1,T:35})}},0).to(".canvas-layer:not(#over-layer):not(#control-layer)",{scale:1,T:35,duration:7,h:"sine",M(){u.q=!1,g("The Core Card",{x:c.ae[2].x}),x(7,10)}},0).then((()=>{for(let t=1;t<=5;t++){const o=$(`<div id="ghost-slot-${t}" class="ghost-zone"></div>`).appendTo("#card-layer");e.set(o,{height:c.ee.height,width:c.ee.width,position:"absolute",pointerEvents:"none",display:"block",x:e.m(u.V[t].ee.Ce,"x"),y:e.m(u.V[t].ee.Ce,"y")})}}))},k=()=>{u.q=!0,e.timeline().to(".canvas-layer:not(#control-layer)",{x:"-=30vw",T:"-=10",h:"back.out(2)",duration:3,M(){u.q=!1}},0).to(".tarot-card-main",{scale:1,duration:.5,h:"sine"},0)},T=()=>{$(".canvas-layer *").remove(),0===$("#blackout-layer").length&&$('<div id="blackout-layer"></div>').prependTo("body"),e.set("#blackout-layer, .canvas-layer",{we:-50,ve:-50,x:c.ae[1].x,y:c.ae[1].y,z(e,t){switch(t.id){case"blackout-layer":return 500;case"background-layer":return c.Me.De-2;case"under-layer":return c.Me.De-1;case"card-layer":return c.Me.De;case"over-layer":return c.Me.De+c.Me.Ke;default:return 0}},T:(e,t)=>/control-layer/.test(t.id)?0:80,scale:1,We:!0});Object.keys(c.Ye);const t=Object.keys(c.Ye).map((e=>new p(e,u)));l.Ae&&t.forEach((e=>e.Ge=e.Ge.slice(0,l.Ae)));const[o,a]=i.He(t,((e,o)=>o<=Math.ceil(t.length/2)-1)),r=(e.m("#card-layer","width")-c.ee.width*o.length-c.spacing.x*(o.length-1))/2,n=(e.m("#card-layer","width")-c.ee.width*a.length-c.spacing.x*(a.length-1))/2;o.forEach(((e,t)=>{e.x=r+.5*c.ee.width+t*(c.spacing.x+c.ee.width),e.y=Number(c.ee.height),u.N.push(e),e.Ne(1)})),a.forEach(((e,t)=>{e.x=n+.5*c.ee.width+t*(c.spacing.x+c.ee.width),e.y=2.5*c.ee.height,u.N.push(e),e.Ne(2)}))},C=()=>{$('<button id="start-debug"></button>').prependTo("#debug-layer").click((()=>{console.log("CLICKED!"),l.initialize()})),e.set("#start-debug",{position:"absolute",top:0,left:0,height:50,width:50,border:"none",outline:"none",opacity:0,pointerEvents:"all"}),p.Re(),d.Re(),b()};console.clear(),T(),$(document).ready((()=>{C()}));export{T as InitializeDomElements,C as Initialize,u as SessionData,m as SetPhase,f as Update,y as ghostPopText};